// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model user {
    id_user                         Int                       @id @default(autoincrement())
    user_name                       String
    pass_word                       String
    name                            String
    gender                          Boolean                   @default(true) //Male:true , female:false
    birth_date                      DateTime
    phone_number                    String?
    avatar                          String?
    is_valid                        Boolean                   @default(true)
    is_librian                      Boolean                   @default(false)
    id_job_title                    Int?
    id_major                        Int?
    job_title                       job_title?                @relation(fields: [id_job_title], references: [id_job_title])
    major                           major?                    @relation(fields: [id_major], references: [id_major]) //n-1 declare one time in n-model
    loan_return_transaction         loan_return_transaction[] @relation(name: "reader")
    loan_return_transaction_librian loan_return_transaction[] @relation(name: "librian")

    loan_request    loan_request[]
    marked_document marked_document[]

    @@map("users")
}

model major {
    id_major   Int    @id @default(autoincrement())
    major_name String
    user       user[]

    @@map("majors")
}

model job_title {
    id_job_title   Int    @id @default(autoincrement())
    job_title_name String
    user           user[]

    @@map("jobs_titles")
}

model category {
    id_category           Int                     @id @default(autoincrement())
    category_name         String
    document_ref_category document_ref_category[]

    @@map("categories")
}

model document_ref_category {
    ISBN        String
    category_id Int
    category    category @relation(fields: [category_id], references: [id_category])
    document    document @relation(fields: [ISBN], references: [ISBN])

    @@id([ISBN, category_id])
}

model document_variant {
    variant_id            Int                     @id @default(autoincrement())
    ISBN                  String
    quantity              Int
    published_date        DateTime
    document              document                @relation(fields: [ISBN], references: [ISBN])
    document_puchase_list document_puchase_list[]
    loan_list_document    loan_list_document[]
    image                 document_image[]

    @@map("document_variants")
}

model document {
    ISBN                       String                       @id
    document_name              String
    id_author                  Int
    id_publisher               Int
    id_category                Int
    description                String?
    author                     author                       @relation(fields: [id_author], references: [id_author])
    publisher                  publisher                    @relation(fields: [id_publisher], references: [id_publisher])
    variants                   document_variant[]
    document_ref_category      document_ref_category[]
    loan_request_list_document loan_request_list_document[]

    @@map("documents")
}

model document_purchase {
    id_purchase           Int                     @id @default(autoincrement())
    variant_id            Int
    id_supplier           Int
    purchase_date         DateTime
    quantity              Int
    price                 Int
    supplier              supplier                @relation(fields: [id_supplier], references: [id_supplier])
    document_puchase_list document_puchase_list[]

    @@map("document_puchases")
}

model document_puchase_list {
    variant_id  Int
    purchase_id Int

    document_purchase document_purchase @relation(fields: [purchase_id], references: [id_purchase])
    variant           document_variant  @relation(fields: [variant_id], references: [variant_id])

    @@id([variant_id, purchase_id])
}

model loan_request {
    id_loan_request             Int                          @id @default(autoincrement())
    id_reader                   Int
    id_loan_list_document       Int
    create_at                   DateTime                     @default(now())
    user                        user                         @relation(fields: [id_reader], references: [id_user])
    loan_request_list_documents loan_request_list_document[]

    @@map("loan_requests")
}

model loan_list_document {
    quantity                Int
    id_variant              Int
    id_loan_return          Int
    note                    String                  @db.VarChar(300)
    variant                 document_variant        @relation(fields: [id_variant], references: [variant_id])
    loan_return_transaction loan_return_transaction @relation(fields: [id_loan_return], references: [id_loan_return])

    @@id([id_loan_return, id_variant])
    @@map("loan_list_documents")
}

model loan_request_list_document {
    id_loan_request Int
    quantity        Int
    isbn            String
    documnet        document     @relation(fields: [isbn], references: [ISBN])
    loan_request    loan_request @relation(fields: [id_loan_request], references: [id_loan_request])

    @@id([isbn, id_loan_request])
    @@map("loan_request_list_document")
}

model loan_return_transaction {
    id_loan_return     Int                  @id @default(autoincrement())
    id_reader          Int
    id_punish          Int?
    return_date        DateTime?
    id_libian          Int                  @unique
    create_at          DateTime             @default(now())
    is_returned        Boolean              @default(false)
    punishment         punishment?          @relation(fields: [id_punish], references: [id_punish])
    user               user                 @relation(fields: [id_reader], references: [id_user], name: "reader")
    librian            user                 @relation(fields: [id_libian], references: [id_user], name: "librian")
    loan_list_document loan_list_document[]

    @@map("loan_return_transactions")
}

model marked_document {
    id          Int  @id @default(autoincrement())
    id_reader   Int
    id_document Int
    reader      user @relation(fields: [id_reader], references: [id_user])

    @@map("marked_documents")
}

model author {
    id_author   Int        @id @default(autoincrement())
    author_name String
    document    document[]

    @@map("authors")
}

model publisher {
    id_publisher   Int        @id @default(autoincrement())
    publisher_name String
    document       document[]

    @@map("publishers")
}

model supplier {
    id_supplier   Int                 @id @default(autoincrement())
    supplier_name Int
    purchase      document_purchase[]

    @@map("suppliers")
}

model document_image {
    id      Int              @id @default(autoincrement())
    vid     Int
    image   String           @unique
    variant document_variant @relation(fields: [vid], references: [variant_id])

    @@map("docment_images")
}

model punishment {
    id_punish               Int                       @id @default(autoincrement())
    reason                  String
    is_handled              Boolean                   @default(false)
    loan_return_transaction loan_return_transaction[]

    @@map("punishments")
}

model media {
    id        Int    @id @default(autoincrement())
    name      String
    file_name String
    mime_type String
    size      Int
    key       String

    @@map("media")
}
